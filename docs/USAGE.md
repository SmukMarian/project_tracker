# Руководство по запуску

Эти шаги рассчитаны на чистое окружение и помогают быстро поднять backend, фронтенд или десктоп-обёртку.

## Требования
- Python 3.11–3.12 и `pip`.
- Node.js 18+ и `npm` для Vite/React фронтенда.
- Права записи в выбранный workspace: туда кладутся база, медиафайлы (`media/`), логи (`logs/`) и обновления (`updates/`).

Рекомендуем создать виртуальное окружение (`python -m venv .venv && source .venv/bin/activate`) перед установкой Python-зависимостей.

## Установка зависимостей
1. Установите backend-зависимости из корня репозитория:
   ```bash
   pip install -r requirements.txt
   ```
2. Установите frontend-зависимости:
   ```bash
   cd frontend
   npm install
   ```

## Запуск backend
1. Убедитесь, что выбрано рабочее пространство. Можно указать путь через API (`POST /workspace {"path": "<путь>"}`) или в верхнем меню SPA.
2. Запустите сервер разработки:
   ```bash
   uvicorn backend.app:app --reload
   ```
3. Проверьте интерактивную документацию по адресу http://localhost:8000/docs.

Если в `frontend/dist` лежит сборка, backend автоматически отдаёт SPA по адресу http://localhost:8000/app/.

## Запуск frontend (dev)
1. Перейдите в `frontend/` и убедитесь, что зависимости установлены (`npm install`).
2. Запустите Vite:
   ```bash
   npm run dev
   ```
3. Откройте URL, который покажет Vite (по умолчанию http://localhost:5173). Для работы API по умолчанию обращается к `http://localhost:8000`.

## Desktop-режим
1. Убедитесь, что Python-зависимости установлены и есть собранный фронтенд (`npm run build`).
2. Запустите лаунчер из корня:
   ```bash
   python desktop.py
   ```
   По умолчанию он поднимет backend на `http://127.0.0.1:8000` и откроет окно с `http://127.0.0.1:8000/app/`.
3. Если нужен внешний UI (например, dev-сервер Vite), укажите флаг `--ui-url`:
   ```bash
   python desktop.py --ui-url http://localhost:5173
   ```
4. Флаг `--no-backend` позволяет подключиться к уже запущенному серверу без автозапуска, а `--update-url` включает проверку обновлений по JSON-манифесту.

## Готовый запуск
- **Сборка фронтенда + backend:** после `npm run build` и запуска `uvicorn backend.app:app --reload` откройте http://localhost:8000/app/.
- **Dev-сценарий:** поднимите backend командой выше и откройте URL Vite (обычно http://localhost:5173); при необходимости передайте его в desktop-обёртку через `--ui-url`.

Убедитесь, что workspace указывает на существующую папку с правами записи — именно туда сохраняются медиа, логи и база данных.

## Медиа и прогресс
- Обложку проекта и вложения можно добавить в диалоге создания/редактирования проекта: поле «Обложка» принимает изображение, «Вложения» — любые файлы. Файлы сохраняются в подкаталог `media/` внутри выбранного workspace и сразу отображаются в карточке проекта.
- Общий прогресс и KPI видны в левой панели списка проектов, а подробный отчёт по KPI открывается кнопкой «KPI» в верхнем меню; запрос идёт к endpoint'у `/kpi` backend'а.
